# 一、Elasticsearch 触发了 磁盘水位保护机制
当 Elasticsearch 检测到磁盘使用率过高时，会自动将索引设置为 只读模式（read-only-allow-delete），以防止磁盘写满导致集群崩溃。

flood-stage watermark（洪峰水位）：默认为 95% 磁盘使用率
一旦磁盘使用超过 95%，Elasticsearch 会：
阻止向该节点上的索引写入新数据
给索引加上 read-only-allow-delete 块
导致 Kibana 无法初始化 .kibana_task_manager 等系统索引

这是 Elasticsearch 的安全保护机制，不是 Kibana 的问题。导致 kibana 无法访问 Elasticsearch，出现如下报错日志：
```shell
FATAL  Error: Unable to complete saved object migrations for the [.kibana_task_manager] index. 
Please check the health of your Elasticsearch cluster and try again. 
Error: [cluster_block_exception]: index [.kibana_task_manager_7.13.0_001] blocked by: [TOO_MANY_REQUESTS/12/disk usage exceeded flood-stage watermark, 
index has read-only-allow-delete block];
```

即使你已经释放了空间，Elasticsearch 不会自动解除只读状态，必须手动解除：
```shell
$ curl -X PUT "localhost:9200/_all/_settings" \
  -H "Content-Type: application/json" \
  -d '{
    "index.blocks.read_only_allow_delete": null
  }'
```
Elasticsearch集群的磁盘使用量已超过洪水警戒水位线（flood-stage watermark），触发了索引的只读保护机制，使用如下命令临时解除只读限制（立即生效但需后续处理根本问题）：
```shell
$ curl -XPUT "http://localhost:9200/_all/_settings" -H 'Content-Type: application/json' -d'
{
"index.blocks.read_only_allow_delete": null
}'
```
