# 一、容器 NetworkMode 网络模式

在使用 `Docker` 部署容器时，若未显式指定网络模式，容器将默认使用 `bridge`（桥接）网络模式。

## 1、bridge（桥接）网络模式

在 `bridge` 模式下，`Docker` 会在宿主机上创建一个虚拟网桥（默认为 `docker0`），所有容器都会连接到这个网桥，每个容器会被分配一个独立的 IP 地址（通常位于 172.x.x.x 私有网段）。
容器之间的通信时，可以通过 自身IP地址  或 通过 Docker 的 自定义网段实现基于服务名称的 DNS 解析。
容器与外部通信时，通过 NAT（网络地址转换） 和 iptables 规则实现端口映射。

- 特点：
    - bridge 模式提供了良好的网络隔离，容器 IP 为私有地址，外部无法直接访问（需端口映射）；
    - 需端口映射（-p）暴露服务到宿主机;
    - 容器间通信需经网桥转发，可能引入轻微延迟，会导致集群中健康检查异常;

- 应用场景：
    - 单主机多容器隔离部署。

## 2、host 网络模式
容器将共享宿主机的网络命名空间，直接使用宿主机的网络协议栈，不再拥有独立的网络端口 和 IP 地址。
容器内的服务可以直接绑定到宿主机的端口（如 8080），无需配置 -p 或 -P 进行端口映射。

- 特点：
    - 这种方式减少了网络栈的中间层，性能更高，延迟更低；
    - 需避免与宿主机其它服务端口冲突，隔离性差；

- 应用场景：
    - 高性能需求（如数据库、网络密集型应用）

### host 模式只支持 Linux
- host 网络模式只在 Linux 下有效。在 macOS 和 Windows 上，Docker Desktop 实际上运行在一个 Linux 虚拟机（VM）中。
- 当你指定 --network host，容器会和虚拟机共享网络，而不是和你的物理 Mac 共享网络。
- 你的 Mac 访问的“localhost”是你自己的操作系统，而容器的“localhost”指向 Docker 虚拟机的网络空间，两者不是同一个。
- Docker VM 的IP地址为：127.0.0.1（localhost）