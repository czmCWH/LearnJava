# 一、volume 数据卷
## 1、什么是卷？
卷是容器的持久化数据存储，由 Docker 创建和管理。
创建一个卷时，它存储在Docker主机上的一个目录中，此目录用于存储卷数据。将卷挂载到容器中时，该卷的目录就是被挂载到容器中的目录。

卷挂载到容器后，卷目录会 映射 容器内的目录，二者之间资源文件即可双向同步。这样，方便开发者操作容器内文件，或者迁移容器产生的数据。

- 创建卷的2种方式：
  - 方式1，`docker volume create`，显示创建卷。
  - 方式2，在创建容器或服务时，使用 `-v 数据卷名:容器内目录` 选项创建卷。 
  - ⚠️ 挂载 volume 只能在创建容器或服务时进行，如 `docker run` 或 `docker service create`（如果卷不存在，会自动创建）。

## 2、volume 与 `bind mounts` 的区别 ⚠️
卷是持久化 Docker容器 生成和使用的数据的 `首选机制`。
`bind mounts` 依赖于主机的目录结构和操作系统，而 `volume` 则完全由 Docker 管理。

## 3、volume 的常用命令
```shell
# 查看 volume 命令
$ docker volume --help

$ docker volume ls：         # 查询宿主机上所有的数据卷
$ docker volume create 数据卷名：       # 创建数据卷；
$ docker volume rm 数据卷名：         # 删除指定数据卷
$ docker volume inspect 数据卷名：    # 查看某个数据卷详情
$ docker volume prune 数据卷名：      # 删除未使用的数据卷
```


# 二、使用 volume 案例 - 利用 nginx 部署静态资源
创建 nginx 容器，修改 nginx 容器内的 html 目录（`/usr/share/nginx/html`）下的 index.html 文件；
将静态资源（如：图片）部署到 nginx 的 html 目录；

```shell
# 创建 nginx 容器时，创建 html 数据卷挂载到 nginx容器的 /usr/share/nginx/html 目录  
$ docker run -d --name nginx -p 80:80 -v html:/usr/share/nginx/html nginx

# 查看所有数据卷列表
$ docker volume ls
DRIVER    VOLUME NAME
local     html

# 查看 html 数据卷 的详情
$ docker volume inspect html
[
    {
        "CreatedAt": "2025-07-18T08:52:04Z",
        "Driver": "local",
        "Labels": null,
        "Mountpoint": "/var/lib/docker/volumes/html/_data",   # ⚠️ 挂载点，即此数据卷映射的主机磁盘目录
        "Name": "html", # 数据卷名字
        "Options": null,
        "Scope": "local"
    }
]

# ⚠️⚠️⚠️，在 MacOS 上无法切换到此目录！！！这只是一个虚拟目录。如果是 linux 系统则会存在此目录
$ cd /var/lib/docker/volumes/html/_data
```

## 容器的匿名数据卷
当创建 mysql 容器时，默认会创建匿名数据卷持久化数据库数据。如下所示，通过查看容器详情命令，查看其匿名数据卷：
```shell
$ docker inspect mysql
[
    {
        #... 
        "Mounts": [
            {
              # ⚠️，创建 mysql 容器时，会自动添加匿名数据卷：Name 数据卷名，Source 指宿主机目录，Destination 指容器内的目录 
                "Type": "volume",   # ⚠️ volume 表示挂载的是 数据卷
                "Name": "695bf26ed3c8c61a7c3b18fdf198a2e3da1250db25a497b1836c963737419286",
                "Source": "/var/lib/docker/volumes/695bf26ed3c8c61a7c3b18fdf198a2e3da1250db25a497b1836c963737419286/_data",   # 宿主机目录
                "Destination": "/var/lib/mysql",  # 容器内的目录
                "Driver": "local",
                "Mode": "",
                "RW": true,
                "Propagation": ""
            }
        ],
        "Config": {
          #...
        },
        #...
    }
]

# 查询宿主机上所有的数据卷
$ docker volume ls    
```
