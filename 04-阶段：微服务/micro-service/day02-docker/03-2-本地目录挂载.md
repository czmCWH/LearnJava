# 一、Bind Mount：绑定挂载、本地目录挂载
`Bind Mount`，是指将指定主机上的文件或目录挂载到容器的目录。
而使用 volume，是在主机上的Docker存储目录中自动创建一个新目录，Docker管理该目录的内容。

⚠️：当使用 绑定挂载 将主机的文件或目录 绑定到 容器内的文件或目录时，则主机挂载的内容 会覆盖 容器内的先前存在的文件。

- 绑定挂载语法： 
  - 在执行 `docker run` 命令时，使用 `-v 本地目录:容器内目录` 可以完成本地目录挂载;
  - 注意：本地目录必须以 `“/” 或 "./"` 开头，如果直接以名称开头，会被识别为 `数据卷` 而非 `本地目录`;
    ```shell
    -v mysql:/var/lib/mysql        # 会被识别为一个数据卷叫 `mysql`;
    -v ./mysql:/var/lib/mysql      # 会被识别为当前宿主机的 `mysql` 目录;
    ```
    
> 开发中，Bind mounts 使用较多！


# 二、案例 - 本地目录挂载
- 案例：创建 MySql 容器，并基于本地目录挂载实现 MySql 容器 
    数据目录`/var/lib/mysql`（存放数据的目录），
    配置文件`/etc/mysql/conf.d`（创建容器会采用此配置），
    初始化脚本`/docker-entrypoint-initdb.d`（仅在容器首次启动时才会执行此sql脚本）
    的目录挂载。

- 如何知道 MySql 这些配置目录？
  - 通过官方文档查询：https://hub.docker.com/_/mysql#how-to-use-this-image

- 案例实现：宿主机目录挂载到 MySql 容器对应关系如下：
  1. 挂载 /root/mysql/data 到容器内的 /var/lib/mysql
  2. 挂载 /root/mysql/init(携带`/file/01-mysql挂载目录/init` 到容器内的) /docker-entrypoint-initdb.d
  3. 挂载 /root/mysql/conf(携带`/file/01-mysql挂载目录/conf`) 到容器内的 /etc/mysql/conf.d


### 步骤1：挂载 宿主机目录 到 mysql 容器：

```shell
# 删除已经存在的mysql容器
$ docker ps -a
$ docker rm mysql

# 重新添加 mysql 容器，并按要求指定挂载的 宿主机目录
$ docker run -d \
--name mysql \
-p 3306:3306 \
-e TZ=Asia/Shanghai \
-e MYSQL_ROOT_PASSWORD=123 \
-v /Users/chen/mysql/data:/var/lib/mysql \   # 挂载 宿主机目录(/Users/chen/mysql/data) : mysql容器目录(/var/lib/mysql)
-v /Users/chen/mysql/init:/docker-entrypoint-initdb.d \   # 创建容器时执行的 sql 初始脚本
-v /Users/chen/mysql/conf:/etc/mysql/conf.d \   # 指定数据库的 字符编码+时区
mysql

# 查看容器详情，检查挂载目录
$ docker inspect mysql
[
    {
        #...
        "Mounts": [
            {
                "Type": "bind",   # ⚠️  bind 是指 绑定挂载，即将宿主机（Host）上的一个 目录或文件 直接挂载到容器（Container）中的指定路径。
                "Source": "/Users/chen/mysql/data", # 宿主机目录
                "Destination": "/var/lib/mysql",  # 容器的目录
                "Mode": "",
                "RW": true,
                "Propagation": "rprivate"
            },
            {
                "Type": "bind",
                "Source": "/Users/chen/mysql/init",
                "Destination": "/docker-entrypoint-initdb.d",
                "Mode": "",
                "RW": true,
                "Propagation": "rprivate"
            },
            {
                "Type": "bind",
                "Source": "/Users/chen/mysql/conf",
                "Destination": "/etc/mysql/conf.d",
                "Mode": "",
                "RW": true,
                "Propagation": "rprivate"
            }
        ],
        "Config": {
            #...
        },
        #...
    }
]
```

### 步骤2：查询挂载后的 宿主机目录是否生效
```shell
# 进入数据库容器
$ docker exec -it mysql /bin/bash

# 登录 mysql
bash-5.1# mysql -uroot -p123
# 查看配置 `day02-docker/file/01-mysql挂载目录/conf` 的字符编码
mysql> show variables like "%char%";
+--------------------------+--------------------------------+
| Variable_name            | Value                          |
+--------------------------+--------------------------------+
| character_set_client     | utf8mb4                        |
| character_set_connection | utf8mb4                        |
| character_set_database   | utf8mb4                        |
| character_set_filesystem | binary                         |
| character_set_results    | utf8mb4                        |
| character_set_server     | utf8mb4                        |
| character_set_system     | utf8mb3                        |
| character_sets_dir       | /usr/share/mysql-9.3/charsets/ |
+--------------------------+--------------------------------+
# 查看所有的数据库
mysql> show databases;
+--------------------+
| Database           |
+--------------------+
| hmall              |
| information_schema |
| mysql              |
| performance_schema |
| sys                |
+--------------------+
# 切换到由 `day02-docker/file/01-mysql挂载目录/init` 中sql脚本创建的数据库
mysql> use hmall;
mysql> show tables;
# 查看表信息
mysql> select * from address;
+----+---------+----------+--------+--------------+-------------+--------------------+-----------+------------+-------+
| id | user_id | province | city   | town         | mobile      | street             | contact   | is_default | notes |
+----+---------+----------+--------+--------------+-------------+--------------------+-----------+------------+-------+
| 59 |       1 | 北京     | 北京   | 朝阳区       | 13900112222 | 金燕龙办公楼       | 李嘉诚    | 0          | NULL  |
| 60 |       1 | 北京     | 北京   | 朝阳区       | 13700221122 | 修正大厦           | 李佳红    | 0          | NULL  |
| 61 |       1 | 上海     | 上海   | 浦东新区     | 13301212233 | 航头镇航头路       | 李佳星    | 1          | NULL  |
| 63 |       1 | 广东     | 佛山   | 永春         | 13301212233 | 永春武馆           | 李小龙    | 0          | NULL  |
+----+---------+----------+--------+--------------+-------------+--------------------+-----------+------------+-------+
4 rows in set (0.009 sec)

# 退出数据库
mysql> exit;
Bye
# 退出 mysql 容器
bash-5.1#  exit;
exit
```

### 删除 mysql 容器后，重新运行部署 mysql 容器，`/docker-entrypoint-initdb.d` 目录中的sql语句不执行
`MySQL` 官方镜像仅在容器首次启动时才会执行 `/docker-entrypoint-initdb.d` 目录下的SQL文件‌。
  解决办法：
  方法1：删除宿主机的 `/root/mysql/data` 中的内容，重新部署mysql容器。
  方法2：删除 mysql 容器、mysql 镜像，从头部署。