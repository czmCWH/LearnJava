# 一、定时任务框架 - Spring Task【重点】
* `Spring Task` 是 `Spring` 框架提供的任务调度工具，可以按照约定的时间自动执行某个代码逻辑。
* 作用：定时自动执行某段 `Java` 代码。
* 只要是需要定时处理的场景都可以使用 `Spring Task`，例如：信用卡还款提醒；入职纪念日通知；火车票处理未支付订单等。

## cron 表达式（即用于设置定时时间）
1、概念：`cron` 表达式其实就是一个字符串，通过 `cron` 表达式可以定义任务触发的时间；

2、构成规则：

* 分为6或7个域，由空格分隔开，每个域代表一个含义。
* 每个域的含义分别为：`秒、分钟、小时、日、月、周、年(可选,不写)`
* 注意⚠️：`SpringTask` 定时任务框架不支持年份字段，只有6个域;

> 例如：12月12日上午9点整 对应的 cron 表达式为：`"0 0 9 12 12 ?"`

3、cron表达式在线生成器：https://cron.qqe2.com/


## 1、Spring Task 基本使用
1、案例：每隔5秒，在idea控制台打印一次日志:【执行定时任务{当前时间}】

2、使用步骤：
1. 导入 maven 坐标 `spring-context`（`spring-boot-starter`依赖中已集成，不需要再次导入）
2. 在 `启动类` 上添加注解 `@EnableScheduling` 开启任务调度；
3. 自定义定时任务类，并加上 `@Component` 注解交给 IOC 容器管理；
4. 类中定义方法，方法上加上 `@Scheduled(cron="cron表达式")` 注解；
5. 启动项目测试；

> 代码实现：`/task/DemoTask.java`

## 2、Spring Task 的应用 - 处理超时订单

场景1、支付超时：用户下单后未支付，订单一直处于待支付状态；

场景2、派送超时：用户收货后管理端未点击完成按钮，订单一直处于 “派送中” 状态；

3、实现逻辑:

通过定时任务`每分钟检查一次`是否存在支付超时订单(下单后超过15分钟仍未支付则判定为支付超时订单)，如果存
    在则修改订单状态为“已取消”。（由于任务是消耗资源的，所以需要每分钟检查一次。）
    
通过定时任务`每天凌晨1点检查`是否存在“派送中”的订单，如果存在则修改订单状态为“已完成“。（因为白天使用用户多，凌晨流量小，不容易出问题）


> 代码实现：`/task/OrderTask.java`