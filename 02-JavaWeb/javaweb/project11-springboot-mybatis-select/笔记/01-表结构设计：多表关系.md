多表关系；
多表查询；
员工列表查询；

# 一、多表关系
项目开发中，在进行数据库表结构设计时，会根据业务需求及业务模块之间的关系，分析并设计表结构。由于业务之间相互关联，
所以各个表结构之间也存在着各种联系。

⚠️ 在设计表结构时，表与表之间的关系分为三种：
* 一对多(多对一)，项目中使用最多；
* 一对一，比较多；
* 多对多；


# 二、一对多(多对一) 关系
案例：部门与员工的关系。一个部门下有多个员工，一个员工一般属于一个部门。

部门：表示一的一方，即父表；
员工：表示多的一方，即子表；

> ⚠️ 数据库中如何体现一对多的表关系?
> 	在 子表 中添加一个字段去关联 父表 中的主键（子表 中的字段存储 父表 对应字段的值）。

## 1.1、外键约束
1、一对多表关系存在问题：
如果父表中的某一条数据被删除了，但子表中的字段存储数据却还保存着该数据的主键，则此时出现了数据的不完整、不一致问题。

2、原因：
目前上述的两张表，在数据库层面，并未建立关联，所以是无法保证数据的 一致性 和 完整性 和 正确性的。即存在脏数据（数据多余的、错误的）。

3、解决办法：
给子表 新增的字段(存储父表主键) 添加外键约束。即，删除父表数据时，数据库会检查子表是否用到该数据，如果用到了sql执行会报错。

外键约束语法如下：
```sql
-- 1、创建子表时指定
create table 子表名称 (
    字段名 数据类型,
	-- 在所有字段描述完毕后，再额外添加如下外键约束：
    [constraint] [外键名称] foreign key (子表的外键字段名) references 主表 (主表的主键字段名)
);

-- 2、表创建完毕后，添加外键（DDL语句）
alter table 子表 add constraint 外键名称 foreign key (子表的外键字段名) references 主表 (主表的主键字段名);
```

> 外键名称规范：fk_子表名称_子表的外键字段名

如下代码所示，给 emp(员工表)的 dept_id 添加外键约束，让其关联到 dept(部门表) 的主键 id：
```sql
-- 方式1
create table emp(
   dept_id     int unsigned comment '关联的部门ID',
	constraint fk_emp_dept_id foreign key (dept_id) references dept (id)
);

-- 方式2
alter table emp add constraint fk_emp_dept_id foreign key (dept_id) references dept (id);
```

> 数据库一些定义：
> key：具有约束的作用，如：主键、唯一键；
> 索引：提高查询效率；


## 1.2、⚠️ 项目开发中禁止使用物理外键

### 物理外键（即外键约束）
概念：使用 `foreign key` 定义外键关联另外一张表。
作用：多表操作中保证数据的一致性、完整性和正确性。
缺点：
1. 会影响 增、删、改 的效率，因为每次操作都需要检查外键关系。
2. 仅用于单节点数据库，不适用于分布式、集群场景。
3. 容易引发数据库的死锁问题，消耗性能。
优点：保证数据的 `一致性 和 完整性 和 正确性`。

### 逻辑外键
* 概念：是指没有 `foreign key` 约束的外键；它是在 `Java` 代码中写业务层逻辑，来解决外键关联。
* 通过逻辑外键，就可以很方便的解决上述问题 --- 开发中使用！ 



# 三、一对一关系
案例：用户 与 身份证的关系。
关系：一对一关系，多用于单表拆分，将一张表的基础字段放在一张表中，其他字段放在另一张表中，以提升操作效率。
⚠️ 实现：在任意一方加入`外键`，关联另外一方的`主键`，并且设置`外键`为唯一的(`unique`)。

> 一对一关系 其实是 特殊的一对多关系。

## 为什么要单表拆分？
例如，tb_user 表中存在（id、name、gender、phone、degree、nationality、birthday、idcard、issued、expire_begin、expire_end）这些字段，常用只有（id、name、gender、phone、degree），其它字段基本上用不到，但数据必须需要。

为了提高查询效率，使得只查询需要的数据，可以把一张表拆分成2张表：
* `tb_user 表（id、name、gender、phone、degree）；`
* `tb_user_card 表（id、nationality、birthday、idcard、issued、expire_begin、expire_end、user_id）；`




# 四、多对多关系
案例：学生 与 课程的关系；
关系：一个学生可以选修多门课程，一门课程也可以供多个学生选择；
⚠️ 实现：在多张表的基础上建立第三张`中间表`，中间表至少包含`两个外键`，分别关联`两方主键`。如：学生课程关系表（学生ID+学生选修的课程ID）

