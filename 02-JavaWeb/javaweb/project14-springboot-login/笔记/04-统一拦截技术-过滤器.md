# 一、过滤器 Filter 
* 概念：Filter 过滤器，是传统 JavaWeb 开发中的三大组件(`Servlet(废弃)、Filter、Listener(废弃)`)之一。
* 过滤器可以把对资源的请求拦截下来，从而实现一些特殊的功能。
* 过滤器一般完成一些通用的操作，比如：`登录校验、统一编码处理、敏感字符处理`等。


## 1.1、Filter 快速入门
步骤1、定义 Filter：定义一个类，实现 `Filter` 接口，并重写其所有方法；
步骤2、配置 Filter;
    - `@WebFilter` 注解，指定拦截的请求；
    - `@ServletComponentScan` 注解，开启 SpringBoot 项目对 Servlte 组建支持；
    - ⚠️ 如果不使用如上上面任一注解，则自定义的 Filter 不生效！


> 代码实现：`/filter/DemoFilter.java`。

```java
/**
 * 自定义 Filter 过滤器入门
 */
@Slf4j
@WebFilter(urlPatterns = "/app/*")  // @WebFilter 注解，用于指定该过滤器拦截哪些请求接口
public class DemoFilter implements Filter {

    /**
     * 初始化方法，在 web 服务器启动的时候，创建 Filter 实例后自动调用，只调用一次。 --- 此方法不常用
     * 一般用于资源环境的准备工作。
     */
    @Override
    public void init(FilterConfig filterConfig) throws ServletException {
        Filter.super.init(filterConfig);    // 此方法有默认实现
        log.info("---  过滤器 1 DemoFilter init");
    }

    /**
     * 每次拦截到了请求时，会触发此方法，会被多次调用
     */
    @Override
    public void doFilter(ServletRequest servletRequest, ServletResponse servletResponse, FilterChain filterChain) throws IOException, ServletException {
        log.info("---  过滤器 2 DemoFilter doFilter");
        log.info("--- doFilter 放行前 逻辑");
        // 1、请求合法 - 放行，让请求访问对应的资源
        // 如果过滤器中不执行放行操作，过滤器拦截到请求之后，就不会访问对应的资源，因此接口响应数据为空。
        filterChain.doFilter(servletRequest, servletResponse);
        log.info("--- doFilter 放行后 逻辑");
    }

    /**
     * 销毁方法，在 web 服务器正常关闭的时候会触发一次  --- 此方法不常用
     * 用于资源释放、环境清理
     */
    @Override
    public void destroy() {
        Filter.super.destroy();
        log.info("---  过滤器 3 DemoFilter destroy");
    }
}
```

```java
// 由于 Filter 是属于传统 JavaWeb 的组件，而在 SpringBoot 项目中使用传统 JavaWeb 开发中的组件时，
// 就必须使用 @SpringBootApplication 注解开启对 Servlet 组件的支持。如果不加此注解，则过滤器不执行。
@ServletComponentScan
@SpringBootApplication
public class Project14SpringbootLoginApplication {
    //...
}
```

## 1.2、@WebFilter 注解拦截路径配置

```java
@WebFilter(urlPatterns = "/login")      // 只有访问 /login 路径时，才会被拦截
@WebFilter(urlPatterns = "/emps/*")     // 访问 /emps 下的所有资源，都会被拦截
@WebFilter(urlPatterns = "/*")          // 拦截所有路径，访问任何资源都会被拦截 --- 常用！
```

## 1.3、过滤器链
一个 web 应用中，可以配置多个过滤器(多个实现 `Filter` 接口的实体类)，这多个过滤器就形成了一个过滤器链。
过滤器链执行的顺序：注解配置的 `Filter`，优先级是按照过滤器类名(字符串)的自然排序。具体图示：`/img/05-过滤器/`


# 二、案例-登录校验Filter
案例分析：
1、拦截到所有请求后，只有 登录请求 不需要校验 `JWT 令牌`；
2、拦截到请求后，只有 `JWT 令牌` 校验通过（合法），才放行；否则都返回为未登录错误；
代码实现：`/filter/LoginCheckFilter.java`
