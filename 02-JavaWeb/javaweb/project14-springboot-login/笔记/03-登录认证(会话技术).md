# 一、登录校验
每个 Http 请求是无状态的（即后一次请求不会携带前一次请求的数据）、相互独立的，因此就算用户调用了 登录接口成功，后续的接口也不知道是否登录过。
登录校验思路：
    - 登录标记：用户登录成功之后返回一个登录标记，在后续的每一次请求中，获取到该标记判定是否登录。 --- 会话技术！
    - 统一拦截技术：拦截前端发送的所有请求。实现技术：过滤器 Filter（属于JavaWeb）、拦截器 Interceptor(属于Spring)



# 二、会话技术
1、会话：用户打开测览器，访问 web 服务器的资源，会话建立，直到有一方断开连接（如：关闭浏览器、停止服务器），会话结束。在一次会话中可以包含多次请求和响应。

2、会话跟踪：一种维护浏览器状态的方法，服务器需要识别多次请求是否来自于同一浏览器，`以便在同一次会话的多次请求间共享数据。`⚠️

3、会话技术解决方案，即会话跟踪方案：
  1. 客户端会话跟踪技术：`Cookie` 数据存储在浏览器。
  2. 服务端会话跟踪技术：`Session` 将数据存储在服务端。
  3. 令牌技术（常用）


## 2.1、Cookie - 客户端会话跟踪技术
- 实现原理：
  1、浏览器访问登录接口时，如果登录成功，服务器端会创建一个 cookie 对象，用来封装多次请求之间需要共享的数据。
  2、然后服务端会在响应数据 response 中设置携带 `set-cookie` 的头，返回给浏览器，浏览器会把接收到的 cookie 自动存储到浏览器本地。
  3、浏览器后续的每一次请求中，都会自动在请求头中将 cookie 发送到服务器端。服务器端拦截到请求后，获取 cookie 中的信息来登录校验，判定是否登录进行其他操作：接口放行 或 响应错误结果。
- 优点：它是HTTP协议中支持的技术。
- 缺点：
  - 移动端APP无法使用，因为 Cookie 数据存储在客户端的浏览器中；
  - Cookie 不安全，用户可以自己禁用Cookie。用户可以通过浏览器禁用 Cookie；
  - Cookie 不能跨域；

> 代码实现：`SessionController.java`


## 2.2、Session - 服务端会话跟踪技术
> Session 服务端会话跟踪技术：本质也是 `Cookie`。
- 实现原理：
  1、当前端发送登录请求时，如果登录成功，服务器端会创建一个 Session 对象保存同一会话中多次请求的共享的数据，此 Session 对象保存在服务器端。然后把 JSESSIONID 通过 Cookie 响应给前端。
  2、前端后续的每一次请求中，都会将 JSESSIONID 发送给服务端，服务端根据此 JSESSIONID 获取 Session 对象，来实现 会话跟踪。
- 优点：Session 值存储在服务端，安全；
- 缺点:
  1、服务器集群环境下无法直接使用 session；
  2、它有 Cookie 所有的缺点；

> 代码实现：`SessionController.java`


### 2.3、令牌技术 --- 主流方案
- 令牌：令牌相当于一个合法的身份凭证，是指后端加密的字符串，用于响应给前端`存储`。前端后续的每次请求时携带到服务器端，服务器端校验令牌的合法性。
- 优点：
  1、支持所有端（PC、移动端）；
  2、解决集群环境下的认证问题；
  3、减轻服务器端存储压力；
- 缺点：
  所有操作需要开发者自己实现，如：生成令牌、以何种方式响应令牌给前端、令牌校验。


  
# 三、JWT 令牌
令牌技术有很多种，`JWT`是令牌技术的一种，全称: `JS0N Web Token` https://jwt.io/。
JWT 令牌定义了一种简洁的、自包含的格式，用于在通信双方以 `json` 数据格式安全的传输信息。

* JWT 的组成：
  - 第一部分：`Header` (头)，记录令牌类型、签名算法等。 例如：原始格式：`{"alg":"HS256","type":"JWT"}` 经过 Base64 而来。
  - 第二部分：`Payload`(有效载荷)，携带一些自定义信息、默认信息（令牌有效期）等。 例如：原始格式 `{"id":"1","username":"Tom"}` 经过 Base64 而来。
  - 第三部分：`Signature`(签名)，防止 `Token` 被篡改、确保安全性。它是将 `header、payload` 融入，并加入指定秘钥，通过指定签名算法计算而来。

> `Base64`：是一种基于64个可打印字符(`A-Z a-z 0-9 + /`)来表示二进制数据的编码方式。其中的 `=` 是一个补位符号。

## 生成 / 解析 JWT 令牌

### 1、导入 jjwt 依赖；
```xml
<!--   JWT 令牌依赖     -->
<!-- JDK 8  -->
<dependency>
    <groupId>io.jsonwebtoken</groupId>
    <artifactId>jjwt</artifactId>
    <version>0.9.1</version>
</dependency>

<!-- JDK 9+ -->
<dependency>
    <groupId>io.jsonwebtoken</groupId>
    <artifactId>jjwt</artifactId>
    <version>0.12.3</version>
</dependency>
<dependency>
    <groupId>javax.xml.bind</groupId>
    <artifactId>jaxb-api</artifactId>
    <version>2.3.1</version>
</dependency>
```
### 2、调用官方提供的工具类 Jwts 来生成或解析 jwt 令牌；
代码实现：`test/JWTTest.java`。

生成的令牌可以复制到官网 https://jwt.io/ 查看详细信息。

### 3、JWT令牌解析（校验）时有以下2种情况会报错
1、如果第二部分有效载荷被篡改，抛出异常：
```
io.jsonwebtoken.security.SignatureException: JWT signature does not match locally computed signature. JWT validity cannot be asserted and should not be trusted.
```

2、如果 JWT 令牌过期，抛出异常：
```
io.jsonwebtoken.ExpiredJwtException: JWT expired 82006 milliseconds ago at 2025-06-30T02:25:44.000Z. Current time: 2025-06-30T02:27:06.006Z. Allowed clock skew: 0 milliseconds.
```

> ⚠️ 
> 只要解析 JWT令牌时报错，则说明 JWT令牌被篡改 或 过期失效了。
> JWT校验时使用的签名秘钥，必须和生成JWT令牌时使用的秘钥是配套的


- 问题：虽然通过【会话技术】实现了 登录认证，但是应该如何对每个接口进行登录校验？