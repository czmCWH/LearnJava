# 一、通知类型
根据通知方法 执行时机 的不同，将通知类型分为以下常见的五类:

* `@Around`：环绕通知，此注解标注的通知方法在目标方法前、后都被执行；（最重要，最强大）

* `@Before`：前置通知，此注解标注的通知方法在目标方法前被执行；

* `@After`：后置通知，此注解标注的通知方法在目标方法后被执行，无论是否有异常都会执行；

* `@AfterReturning`：返回后通知，此注解标注的通知方法在目标方法后被执行，有异常不会执行；

* `@AfterThrowing`：异常后通知，此注解标注的通知方法发生异常后执行；


> @Around 环绕通知需要自己调用 `Proceeding]oinPoint.proceed()` 来让原始方法执行，其他通知不需要考虑目标方法执行

`` 注解，作用是将公共的切点表达式抽取出来，需要用到时引用该切点表达式即可。

> 代码实现：`com/czm/aspect/MyAspect1.java`、`com/czm/aspect/MyAspect2.java`


# 二、通知顺序

1、当有多个切面的切入点都匹配到了目标方法，目标方法运行时，多个通知方法都会被执行。

2、通知方法的执行顺序：

* 默认顺序：不同 切面类 中，默认按照切面类的**类名字母排序**：
    
    目标方法前的通知方法（即前置通知）：字母排名靠前的先执行；
    目标方法后的通知方法：字母排名靠前的后执行；

* 自定义执行顺序：用 `@0rder(正负数字)` 加在 切面类 上来控制顺序

    目标方法前的通知方法（即前置通知）：数字小的先执行；
    目标方法后的通知方法：数字小的后执行；
    如果不写数字，即 `@0rder()`，则最后执行；


# 三、切入点表达式
介绍：描述切入点方法的一种表达式。
作用：用来决定项目中的那些方法需要加入通知。
形式：
1、`execution(需匹配的方法签名)`：根据方法签名来匹配；
2、`@annotation(...)`：根据注解匹配；

> 方法签名 == 方法修饰符 + 返回值类型 + 包名 + 类名 + 方法名称 + 方法参数

## 1、切入点表达式 - execution(需匹配的方法签名)

代码实现：`com/czm/aspect/MyAspect3.java`

`execution` 主要根据方法的返回值、包名、类名、方法名、方法参数等信息来匹配，语法为：

```
execution(访问修饰符? 返回值 包名.类名.?方法名(方法参数) throws 异常?)
```

* 其中带 `?` 的表示问号这一部分可以在定义 execution 切面表达式 时省略：

    1、`访问修饰符?`：即可以省略访问修饰符，如：public、protected；
    2、`包名.类名.?`：即可以省略 `包名.类名`;
    3、`throws 异常?`：即可以省略 throws 异常

* execution 切面表达式 中可以使用通配符描述切入点：

1、`*` 表示单个独立的任意符号，可以通配任意返回值、包名、类名、方法名、任意类型的一个参数，也可以通配包、类、方法名的一部分。如下：

```
execution(* com.*.service.*.update*(*))
```

2、`..` 表示多个连续的任意符号，可以通配任意层级的包，或任意类型、任意个数的参数。如下：

```
execution(* com.czm..DeptService.*(..))
```

* 根据业务需要，可以使用 `且(&&)、或()、非(!)` 来组合比较复杂的切入点表达式

### 书写 execution 切入点表达式注意点

a、所有**业务方法名**(service 层)在命名时尽量规范，方便切入点表达式快速匹配。如:`findXxx，updateXxx`。

b、描述切入点方法通常 **基于接口** 描述，而不是直接描述实现类，增强拓展性。

c、在满足业务需要的前提下，**尽量缩小切入点的匹配范围**。如:包名尽量不使用..，使用*匹配单个包



## 2、切入点表达式 - @annotation(自定义注解的全类名)
`@annotation` 切入点表达式，用于匹配标识有特定注解（即开发者自定义的注解）的方法。

代码实现：，`Log.java`，`/aspect/MyAspect4.java`，`/service/impl/DeptServiceImpl.java`

## 3、execution、@annotation 切入点表达式的应用场景

* 如果 `execution` 切入点表达式方便描述指定的方法，就使用 `execution` 表达式。
* 否则，就使用 `@annotation` 切入点表达式。


# 四、连接点
在 `Spring` 中用 `JoinPoint` 抽象了连接点，用它可以获得方法执行时的相关信息，如目标类名、方法名、方法参数等。
* 对于 `@Around` 通知，获取连接点信息只能使用 `ProceedingJoinPoint`
* 对于其它四种通知，获取连接点信息只能使用 `JoinPoint` ，它是 `ProceedingJoinPoint` 的父类型

代码实现：`com/czm/aspect/MyAspect5.java`