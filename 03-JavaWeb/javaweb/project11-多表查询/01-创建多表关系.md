多表关系；
多表查询；
员工列表查询


项目开发中，在进行数据库表结构设计时，会根据业务需求及业务模块之间的关系，分析并设计表结构。由于业务之间相互关联，所以 各个表结构 之间也存在着各种联系，基本上分为三种：
* 一对多(多对一)，项目中使用最多；
* 一对一；
* 多对多；


# 一、一对多(多对一) 关系
例如：部门与员工的关系（一个部门下有多个员工）。

数据库中如何体现一对多的表关系?
	需要在 多的一方 添加字段，该字段为关联 一的一方 的主键。即，在子表中添加一个字段去关联父表中的主键（子表中的字段存储父表对应字段的值）。

部门：表示一的一方，父表；
员工：表示多的一方，子表；

## 如上方式的一对多表关系可能产生的问题
问题：如果父表中的某一条数据被删除了，但子表中的数据却还保存着该数据的主键，则此时出现了数据的不完整、不一致问题。
原因：目前上述的两张表，在数据库层面，并未建立关联，所以是无法保证数据的 一致性 和 完整性 和 正确性的。即存在脏数据（数据多余的、错误的）。
解决方案：外键。

## 解决办法：给子表添加外键约束
即，删除父表数据时，会检查子表是否用到该数据。
可以在创建表时 或 表结构创建完成后，为字段添加外键约束。具体语法如下：

```sql
-- 创建子表时指定
create table 子表名称 (
    字段名 数据类型,
    [constraint] [外键名称] foreign key 子表的外键字段名 references 主表 主表的字段名,
);

-- 表创建完毕后，添加外键（DDL语句）
alter table 子表名 add constraint 外键名称 foreign key(子表的外键字段名) references 主表名(主表字段名);
```

* 外键名称规范：fk_子表名称_子表的外键字段名

如下代码所示，给 emp(员工表)的 dept_id 添加外键，关联到 dept(部门表) 的 id： 

```sql
alter table emp add constraint fk_emp_dept_id foreign key(dept_id) references dept(id);
```

> 数据库一些定义：
> key：具有约束的作用；
> 索引：提高查询效率；

## 外键约束项目中基本不用

### 物理外键

概念：使用 foreign key 定义外键关联另外一张表。
缺点：
1. 影响增、删、改的效率(需要检查外键关系)
2. 仅用于单节点数据库，不适用于分布式、集群场景。
3. 容易引发数据库的死锁问题，消耗性能。

### 逻辑外键
* 概念：是指没有 foreign key 约束的外键；它是在 Java 代码中写业务层逻辑，来解决外键关联。
* 通过逻辑外键，就可以很方便的解决上述问题。

# 二、一对一关系

案例：用户 与 身份证的关系。

关系：一对一关系，多用于单表拆分，将一张表的基础字段放在一张表中，其他字段放在另一张表中，以提升操作效率。

实现：在任意一方加入外键，关联另外一方的主键，并且设置外键为唯一的(UNIQUE)。

> 一对一关系 其实是 特殊的一对多关系。

### 为什么要单表拆分

例如，tb_user 表中存在（id、name、gender、phone、degree、nationality、birthday、idcard、issued、expire_begin、expire_end）这些字段，常用只有（id、name、gender、phone、degree），其它字段基本上用不到，但数据必须需要。

为了提高查询效率，可以把一张表拆分成2张表：
* `tb_user 表（id、name、gender、phone、degree）；`
* `tb_user_card 表（id、nationality、birthday、idcard、issued、expire_begin、expire_end、user_id）；`


# 三、多对多关系
案例：学生 与 课程的关系；
关系：一个学生可以选修多门课程，一门课程也可以供多个学生选择；
实现：在多张表的基础上建立第三张中间表，中间表至少包含两个外键，分别关联两方主键。

